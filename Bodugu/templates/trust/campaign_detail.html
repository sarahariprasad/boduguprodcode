{% extends "base.html" %}
{% load static %}

{% block content %}
<div class="container campaign-detail">
    <div class="row">

        <!-- Campaign Image -->
        <div class="col-md-5 col-sm-12 text-center">
            {% if campaign.image %}
                <img src="{{ campaign.image.url }}" 
                     class="img-responsive img-thumbnail campaign-img" 
                     alt="{{ campaign.title }}">
            {% endif %}
        </div>

        <!-- Campaign Info -->
        <div class="col-md-7 col-sm-12">
            <div class="panel panel-default campaign-info-panel">
                <div class="panel-body">
                    <h2 class="text-primary campaign-title">
                        {{ campaign.title }}
                    </h2>

                    {% if campaign.created_by %}
                        <p><strong>Created By:</strong> {{ campaign.created_by }}</p>
                    {% endif %}

                    <!-- Goal & Raised -->
                    <div class="campaign-goal">
                        <p><strong>Campaign Goal:</strong> ₹{{ campaign.goal_amount|floatformat:2 }}</p>
                        <p><strong>Raised Funds:</strong> ₹{{ campaign.raised_amount|floatformat:2 }}</p>
                        <div class="progress" style="height:22px; border-radius:12px;">
                            <div class="progress-bar progress-bar-success" 
                                 role="progressbar"
                                 style="width: {{ campaign.progress_percentage }}%">
                                {{ campaign.progress_percentage }}%
                            </div>
                        </div>
                    </div>

                    <!-- Dates -->
                    <p>
                        {% if campaign.start_date %}<strong>Start Date:</strong> {{ campaign.start_date }} <br>{% endif %}
                        {% if campaign.end_date %}<strong>End Date:</strong> {{ campaign.end_date }}{% endif %}
                    </p>

                    <!-- Donation Options -->
                    <h4 class="donation-heading">Choose your donation amount</h4>
                    <div class="donation-options">
                        {% for option in donation_options %}
                            <button class="btn btn-default btn-donation" type="button"
                                onclick="
                                    document.getElementById('donation_amount').value={{ option.amount }};
                                    updateDonateButton();
                                ">
                                ₹{{ option.amount }}
                            </button>
                        {% empty %}
                            <p class="text-muted">No predefined donation amounts available for this campaign.</p>
                        {% endfor %}
                    </div>

                    <!-- Other Amount -->
                    <input type="number" id="donation_amount" class="form-control mb-3" placeholder="Other Amount">

                    <!-- Continue Donation Button (Disabled by default) -->
                    <a id="donate-btn" class="btn btn-success btn-donation btn-lg btn-block disabled" 
                       href="javascript:void(0)">
                        CONTINUE DONATION
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Campaign Overview -->
    <div style="margin-top:40px;">
        <h3 class="text-primary campaign-overview-heading">Campaign Overview</h3>
        <p class="text-muted campaign-description">
            {{ campaign.description|safe }}
        </p>
    </div>
</div>

<!-- Scripts -->
<script>
    const donateBtn = document.getElementById('donate-btn');
    const donationInput = document.getElementById('donation_amount');

    // Function to enable/disable the donate button
    function updateDonateButton() {
        const value = donationInput.value.trim();
        if(value && parseFloat(value) > 0){
            donateBtn.href = "{% url 'donation_form' campaign.slug %}?amount=" + value;
            donateBtn.classList.remove('disabled');
        } else {
            donateBtn.href = "javascript:void(0)";
            donateBtn.classList.add('disabled');
        }
    }

    // Listen for typing in custom amount
    donationInput.addEventListener('input', updateDonateButton);

    // Listen for clicks on preset donation buttons
    document.querySelectorAll('.btn-donation[type="button"]').forEach(btn => {
        btn.addEventListener('click', updateDonateButton);
    });

    // Optional: prevent click if disabled
    donateBtn.addEventListener('click', function(e){
        if(donateBtn.classList.contains('disabled')){
            e.preventDefault();
            alert('Please select or enter a donation amount first.');
        }
    });
</script>

<!-- Styles -->
<style>
.campaign-detail {
    margin-top: 100px;
    margin-bottom: 70px;
}

/* Campaign Image */
.campaign-img {
    max-height: 320px;
    object-fit: cover;
    border-radius: 6px;
    margin-bottom: 20px;
}

/* Panel Styling */
.campaign-info-panel {
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    border-radius: 8px;
    padding: 20px;
}

/* Title */
.campaign-title {
    font-weight: 600;
    margin-bottom: 15px;
}

/* Donation Section */
.donation-heading {
    font-weight: 600;
    margin-top: 20px;
    margin-bottom: 10px;
}

.donation-options {
    margin-bottom: 15px;
}
.btn-donation {
    border-radius: 20px;
    margin: 5px 5px 10px 0;
    padding: 8px 18px;
    transition: all 0.3s ease;
    cursor: pointer;
}
.btn-donation:hover {
    background: #28a745;
    color: #fff;
    transform: scale(1.05);
}
.btn-donation.disabled {
    opacity: 0.6;
    pointer-events: none;
}

/* Campaign Overview */
.campaign-overview-heading {
    font-weight: 600;
    margin-bottom: 15px;
}
.campaign-description {
    font-size: 15px;
    line-height: 1.6;
}

/* Responsive */
@media (max-width: 767px) {
    .campaign-detail h2, .campaign-title {
        text-align: center;
        font-size: 20px;
    }
    .campaign-img {
        max-height: 240px;
    }
}
</style>
{% endblock %}